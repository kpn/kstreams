
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Micro streaming framework">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-8.5.10">
    
    
      
        <title>Stream - kstreams</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/brand.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="kpn" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#streams" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="kstreams" class="md-header__button md-logo" aria-label="kstreams" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            kstreams
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Stream
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="kpn" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
            </label>
          
        
          
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="kpn-dark" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
            </label>
          
        
      </form>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/kpn/kstreams" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="kstreams" class="md-nav__button md-logo" aria-label="kstreams" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    kstreams
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/kpn/kstreams" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../engine/" class="md-nav__link">
        StreamEngine
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Stream
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Stream
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#kstreams.streams.Stream" class="md-nav__link">
    Stream
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependency-injection-and-typing" class="md-nav__link">
    Dependency Injection and typing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-stream-instance" class="md-nav__link">
    Creating a Stream instance
  </a>
  
    <nav class="md-nav" aria-label="Creating a Stream instance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#removing-a-stream-from-the-engine" class="md-nav__link">
    Removing a stream from the engine
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#starting-the-stream-with-initial-offsets" class="md-nav__link">
    Starting the stream with initial offsets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stream-crashing" class="md-nav__link">
    Stream crashing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consuming-from-multiple-topics" class="md-nav__link">
    Consuming from multiple topics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changing-consumer-behavior" class="md-nav__link">
    Changing consumer behavior
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manual-commit" class="md-nav__link">
    Manual commit
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yield-from-stream" class="md-nav__link">
    Yield from stream
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-many" class="md-nav__link">
    Get many
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kstreams.streams.Stream.getmany" class="md-nav__link">
    getmany
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rebalance-listener" class="md-nav__link">
    Rebalance Listener
  </a>
  
    <nav class="md-nav" aria-label="Rebalance Listener">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-cases" class="md-nav__link">
    Use cases
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metrics-rebalance-listener" class="md-nav__link">
    Metrics Rebalance Listener
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kstreams.MetricsRebalanceListener" class="md-nav__link">
    MetricsRebalanceListener
  </a>
  
    <nav class="md-nav" aria-label="MetricsRebalanceListener">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kstreams.MetricsRebalanceListener.on_partitions_assigned" class="md-nav__link">
    on_partitions_assigned()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kstreams.MetricsRebalanceListener.on_partitions_revoked" class="md-nav__link">
    on_partitions_revoked()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-commit_1" class="md-nav__link">
    Manual Commit
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kstreams.ManualCommitRebalanceListener" class="md-nav__link">
    ManualCommitRebalanceListener
  </a>
  
    <nav class="md-nav" aria-label="ManualCommitRebalanceListener">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kstreams.ManualCommitRebalanceListener.on_partitions_revoked" class="md-nav__link">
    on_partitions_revoked()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-rebalance-listener" class="md-nav__link">
    Custom Rebalance Listener
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kstreams.RebalanceListener" class="md-nav__link">
    RebalanceListener
  </a>
  
    <nav class="md-nav" aria-label="RebalanceListener">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kstreams.RebalanceListener.on_partitions_assigned" class="md-nav__link">
    on_partitions_assigned()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kstreams.RebalanceListener.on_partitions_revoked" class="md-nav__link">
    on_partitions_revoked()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../backends/" class="md-nav__link">
        Backends
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../metrics/" class="md-nav__link">
        Metrics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../monitoring/" class="md-nav__link">
        Monitoring
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../serialization/" class="md-nav__link">
        Serialization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../test_client/" class="md-nav__link">
        Testing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../middleware/" class="md-nav__link">
        Middleware
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#kstreams.streams.Stream" class="md-nav__link">
    Stream
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependency-injection-and-typing" class="md-nav__link">
    Dependency Injection and typing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-stream-instance" class="md-nav__link">
    Creating a Stream instance
  </a>
  
    <nav class="md-nav" aria-label="Creating a Stream instance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#removing-a-stream-from-the-engine" class="md-nav__link">
    Removing a stream from the engine
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#starting-the-stream-with-initial-offsets" class="md-nav__link">
    Starting the stream with initial offsets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stream-crashing" class="md-nav__link">
    Stream crashing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consuming-from-multiple-topics" class="md-nav__link">
    Consuming from multiple topics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changing-consumer-behavior" class="md-nav__link">
    Changing consumer behavior
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manual-commit" class="md-nav__link">
    Manual commit
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yield-from-stream" class="md-nav__link">
    Yield from stream
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-many" class="md-nav__link">
    Get many
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kstreams.streams.Stream.getmany" class="md-nav__link">
    getmany
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rebalance-listener" class="md-nav__link">
    Rebalance Listener
  </a>
  
    <nav class="md-nav" aria-label="Rebalance Listener">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-cases" class="md-nav__link">
    Use cases
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metrics-rebalance-listener" class="md-nav__link">
    Metrics Rebalance Listener
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kstreams.MetricsRebalanceListener" class="md-nav__link">
    MetricsRebalanceListener
  </a>
  
    <nav class="md-nav" aria-label="MetricsRebalanceListener">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kstreams.MetricsRebalanceListener.on_partitions_assigned" class="md-nav__link">
    on_partitions_assigned()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kstreams.MetricsRebalanceListener.on_partitions_revoked" class="md-nav__link">
    on_partitions_revoked()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-commit_1" class="md-nav__link">
    Manual Commit
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kstreams.ManualCommitRebalanceListener" class="md-nav__link">
    ManualCommitRebalanceListener
  </a>
  
    <nav class="md-nav" aria-label="ManualCommitRebalanceListener">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kstreams.ManualCommitRebalanceListener.on_partitions_revoked" class="md-nav__link">
    on_partitions_revoked()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-rebalance-listener" class="md-nav__link">
    Custom Rebalance Listener
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kstreams.RebalanceListener" class="md-nav__link">
    RebalanceListener
  </a>
  
    <nav class="md-nav" aria-label="RebalanceListener">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kstreams.RebalanceListener.on_partitions_assigned" class="md-nav__link">
    on_partitions_assigned()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kstreams.RebalanceListener.on_partitions_revoked" class="md-nav__link">
    on_partitions_revoked()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/kpn/kstreams/edit/master/docs/stream.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="streams">Streams</h1>
<p>A <code>Stream</code> in <code>kstreams</code> is an extension of <a href="https://aiokafka.readthedocs.io/en/stable/consumer.html">AIOKafkaConsumer</a></p>
<p>Consuming can be done using <code>kstreams.Stream</code>. You only need to decorate a <code>coroutine</code> with <code>@stream_engine.streams</code>. The decorator has the same  <a href="https://aiokafka.readthedocs.io/en/stable/api.html#aiokafkaconsumer-class">aiokafka consumer</a> API at initialization, in other words they accept the same <code>args</code> and <code>kwargs</code> that the <code>aiokafka consumer</code> accepts.</p>


<div class="doc doc-object doc-class">




<h2 id="kstreams.streams.Stream" class="doc doc-heading">
          <code>kstreams.streams.Stream</code>


</h2>


  <div class="doc doc-contents first">

  



  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Stream name</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>topics</code></td>
          <td>
                <code>List[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of topics to consume</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>backend</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="kstreams.backends.Kafka" href="../backends/#kstreams.backends.kafka.Kafka">Kafka</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>backend kstreams.backends.kafka.Kafka:
Backend to connect. Default <code>Kafka</code></p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>func</code></td>
          <td>
                <code>Callable[[<a class="autorefs autorefs-internal" title="kstreams.streams.Stream" href="#kstreams.streams.Stream">Stream</a>], Awaitable[Any]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Coroutine fucntion or generator
to be called when an event arrives</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>config</code></td>
          <td>
                <code>Dict[str, Any]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Stream configuration. Here all the
<a href="https://aiokafka.readthedocs.io/en/stable/api.html#consumer-class">properties</a>
can be passed in the dictionary</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>deserializer</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="kstreams.serializers.Deserializer" href="../serialization/#kstreams.serializers.Deserializer">Deserializer</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Deserializer to be used
when an event is consumed</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>initial_offsets</code></td>
          <td>
                <code>List[<span title="kstreams.TopicPartitionOffset">TopicPartitionOffset</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of
TopicPartitionOffset that will <code>seek</code> the initial offsets to</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>rebalance_listener</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="kstreams.rebalance_listener.RebalanceListener" href="#kstreams.RebalanceListener">RebalanceListener</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Listener
callbacks when partition are assigned or revoked</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>
      <div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><span class="filename">Usage</span><pre><span></span><code><span class="kn">import</span> <span class="nn">aiorun</span>
<span class="kn">from</span> <span class="nn">kstreams</span> <span class="kn">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">ConsumerRecord</span>

<span class="n">stream_engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;my-stream-engine&quot;</span><span class="p">)</span>


<span class="c1"># here you can add any other AIOKafkaConsumer config</span>
<span class="nd">@stream_engine</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="s2">&quot;local--kstreams&quot;</span><span class="p">,</span> <span class="n">group_id</span><span class="o">=</span><span class="s2">&quot;de-my-partition&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">stream</span><span class="p">(</span><span class="n">cr</span><span class="p">:</span> <span class="n">ConsumerRecord</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event consumed: headers: </span><span class="si">{</span><span class="n">cr</span><span class="o">.</span><span class="n">headers</span><span class="si">}</span><span class="s2">, payload: </span><span class="si">{</span><span class="n">cr</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">start</span><span class="p">():</span>
    <span class="k">await</span> <span class="n">stream_engine</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">produce</span><span class="p">()</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="n">loop</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">stream_engine</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">aiorun</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="n">start</span><span class="p">(),</span>
        <span class="n">stop_on_unhandled_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">shutdown_callback</span><span class="o">=</span><span class="n">shutdown</span>
    <span class="p">)</span>
</code></pre></div>
</div>

            <details class="quote">
              <summary>Source code in <code>kstreams/streams.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Stream</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        name str: Stream name</span>
<span class="sd">        topics List[str]: List of topics to consume</span>
<span class="sd">        backend kstreams.backends.Kafka: backend kstreams.backends.kafka.Kafka:</span>
<span class="sd">            Backend to connect. Default `Kafka`</span>
<span class="sd">        func Callable[[&quot;Stream&quot;], Awaitable[Any]]: Coroutine fucntion or generator</span>
<span class="sd">            to be called when an event arrives</span>
<span class="sd">        config Dict[str, Any]: Stream configuration. Here all the</span>
<span class="sd">         [properties](https://aiokafka.readthedocs.io/en/stable/api.html#consumer-class)</span>
<span class="sd">            can be passed in the dictionary</span>
<span class="sd">        deserializer kstreams.serializers.Deserializer: Deserializer to be used</span>
<span class="sd">            when an event is consumed</span>
<span class="sd">        initial_offsets List[kstreams.TopicPartitionOffset]: List of</span>
<span class="sd">            TopicPartitionOffset that will `seek` the initial offsets to</span>
<span class="sd">        rebalance_listener kstreams.rebalance_listener.RebalanceListener: Listener</span>
<span class="sd">            callbacks when partition are assigned or revoked</span>

<span class="sd">    !!! Example</span>
<span class="sd">        ```python title=&quot;Usage&quot;</span>
<span class="sd">        import aiorun</span>
<span class="sd">        from kstreams import create_engine, ConsumerRecord</span>

<span class="sd">        stream_engine = create_engine(title=&quot;my-stream-engine&quot;)</span>


<span class="sd">        # here you can add any other AIOKafkaConsumer config</span>
<span class="sd">        @stream_engine.stream(&quot;local--kstreams&quot;, group_id=&quot;de-my-partition&quot;)</span>
<span class="sd">        async def stream(cr: ConsumerRecord) -&gt; None:</span>
<span class="sd">            print(f&quot;Event consumed: headers: {cr.headers}, payload: {cr.value}&quot;)</span>


<span class="sd">        async def start():</span>
<span class="sd">            await stream_engine.start()</span>
<span class="sd">            await produce()</span>


<span class="sd">        async def shutdown(loop):</span>
<span class="sd">            await stream_engine.stop()</span>


<span class="sd">        if __name__ == &quot;__main__&quot;:</span>
<span class="sd">            aiorun.run(</span>
<span class="sd">                start(),</span>
<span class="sd">                stop_on_unhandled_errors=True,</span>
<span class="sd">                shutdown_callback=shutdown</span>
<span class="sd">            )</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">topics</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">func</span><span class="p">:</span> <span class="n">StreamFunc</span><span class="p">,</span>
        <span class="n">backend</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">Kafka</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">consumer_class</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">Consumer</span><span class="p">]</span> <span class="o">=</span> <span class="n">Consumer</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">deserializer</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">Deserializer</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">initial_offsets</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">TopicPartitionOffset</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rebalance_listener</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">RebalanceListener</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">middlewares</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Middleware</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consumer_class</span> <span class="o">=</span> <span class="n">consumer_class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">Consumer</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deserializer</span> <span class="o">=</span> <span class="n">deserializer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_processing</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_offsets</span> <span class="o">=</span> <span class="n">initial_offsets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seeked_initial_offsets</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rebalance_listener</span> <span class="o">=</span> <span class="n">rebalance_listener</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">middlewares</span> <span class="o">=</span> <span class="n">middlewares</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">udf_handler</span> <span class="o">=</span> <span class="n">UdfHandler</span><span class="p">(</span><span class="n">handler</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># aiokafka expects topic names as arguments, meaning that</span>
        <span class="c1"># can receive N topics -&gt; N arguments,</span>
        <span class="c1"># so we always create a list and then we expand it with *topics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">topics</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">topics</span>

    <span class="k">def</span> <span class="nf">_create_consumer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Consumer</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BackendNotSet</span><span class="p">(</span><span class="s2">&quot;A backend has not been set for this stream&quot;</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">consumer_class</span><span class="p">(</span><span class="o">**</span><span class="n">config</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
            <span class="c1"># Don&#39;t run anymore to prevent new events comming</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_processing</span><span class="p">:</span>
                <span class="c1"># Only enter this block when all the events have been</span>
                <span class="c1"># proccessed in the middleware chain</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Stream consuming from topics </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="si">}</span><span class="s2"> has stopped!!! </span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Only create a consumer if it was not previously created</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_consumer</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">topics</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="p">,</span> <span class="n">listener</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rebalance_listener</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">commit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">offsets</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="n">TopicPartition</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="n">offsets</span><span class="o">=</span><span class="n">offsets</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">getone</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConsumerRecord</span><span class="p">:</span>
        <span class="n">consumer_record</span><span class="p">:</span> <span class="n">ConsumerRecord</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="o">.</span><span class="n">getone</span><span class="p">()</span>  <span class="c1"># type: ignore</span>

        <span class="c1"># call deserializer if there is one regarless consumer_record.value</span>
        <span class="c1"># as the end user might want to do something extra with headers or metadata</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserializer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Deserializers will be deprecated in the future, &quot;</span>
                <span class="s2">&quot;use middlewares instead: https://kpn.github.io/kstreams/middleware/&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserializer</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">consumer_record</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">consumer_record</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">getmany</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">partitions</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">TopicPartition</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">timeout_ms</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">max_records</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="n">TopicPartition</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">ConsumerRecord</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a batch of events from the assigned TopicPartition.</span>

<span class="sd">        Prefetched events are returned in batches by topic-partition.</span>
<span class="sd">        If messages is not available in the prefetched buffer this method waits</span>
<span class="sd">        `timeout_ms` milliseconds.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            partitions List[TopicPartition] | None: The partitions that need</span>
<span class="sd">                fetching message. If no one partition specified then all</span>
<span class="sd">                subscribed partitions will be used</span>
<span class="sd">            timeout_ms int | None: milliseconds spent waiting if</span>
<span class="sd">                data is not available in the buffer. If 0, returns immediately</span>
<span class="sd">                with any records that are available currently in the buffer,</span>
<span class="sd">                else returns empty. Must not be negative.</span>
<span class="sd">            max_records int | None: The amount of records to fetch.</span>
<span class="sd">                if `timeout_ms` was defined and reached and the fetched records</span>
<span class="sd">                has not reach `max_records` then returns immediately</span>
<span class="sd">                with any records that are available currently in the buffer</span>

<span class="sd">        Returns:</span>
<span class="sd">            Topic to list of records</span>

<span class="sd">        !!! Example</span>
<span class="sd">            ```python</span>
<span class="sd">            @stream_engine.stream(topic, ...)</span>
<span class="sd">            async def stream(stream: Stream):</span>
<span class="sd">                while True:</span>
<span class="sd">                    data = await stream.getmany(max_records=5)</span>
<span class="sd">                    print(data)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">partitions</span> <span class="o">=</span> <span class="n">partitions</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="o">.</span><span class="n">getmany</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
            <span class="o">*</span><span class="n">partitions</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="o">=</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="n">max_records</span><span class="o">=</span><span class="n">max_records</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">udf_handler</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">UDFType</span><span class="o">.</span><span class="n">NO_TYPING</span><span class="p">:</span>
                <span class="c1"># normal use case</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Streams with `async for in` loop approach might be deprecated. &quot;</span>
                    <span class="s2">&quot;Consider migrating to a typing approach.&quot;</span>
                <span class="p">)</span>

                <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">udf_handler</span><span class="o">.</span><span class="n">handler</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">await</span> <span class="n">func</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Typing cases</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isasyncgenfunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">udf_handler</span><span class="o">.</span><span class="n">handler</span><span class="p">):</span>
                    <span class="c1"># Is not an async_generator, then create `await` the func</span>
                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">func_wrapper_with_typing</span><span class="p">()</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">func_wrapper_with_typing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
            <span class="n">cr</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">getone</span><span class="p">()</span>
            <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_processing</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">seek_to_initial_offsets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">seeked_initial_offsets</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">assignments</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Set</span><span class="p">[</span><span class="n">TopicPartition</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="o">.</span><span class="n">assignment</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_offsets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">topicPartitionOffset</span><span class="p">:</span> <span class="n">TopicPartitionOffset</span>
                <span class="k">for</span> <span class="n">topicPartitionOffset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_offsets</span><span class="p">:</span>
                    <span class="n">tp</span> <span class="o">=</span> <span class="n">TopicPartition</span><span class="p">(</span>
                        <span class="n">topic</span><span class="o">=</span><span class="n">topicPartitionOffset</span><span class="o">.</span><span class="n">topic</span><span class="p">,</span>
                        <span class="n">partition</span><span class="o">=</span><span class="n">topicPartitionOffset</span><span class="o">.</span><span class="n">partition</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">tp</span> <span class="ow">in</span> <span class="n">assignments</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span>
                            <span class="n">partition</span><span class="o">=</span><span class="n">tp</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">topicPartitionOffset</span><span class="o">.</span><span class="n">offset</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="s2">&quot;You are attempting to seek on an TopicPartitionOffset &quot;</span>
                            <span class="s2">&quot;that isn&#39;t in the consumer assignments. &quot;</span>
                            <span class="s2">&quot;The code will simply ignore the seek request &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;on this partition. </span><span class="si">{</span><span class="n">tp</span><span class="si">}</span><span class="s2"> is not in the partition &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;assignment. The partition assignment is </span><span class="si">{</span><span class="n">assignments</span><span class="si">}</span><span class="s2">.&quot;</span>
                        <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seeked_initial_offsets</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">async</span> <span class="k">def</span> <span class="fm">__aenter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Stream&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start the kafka Consumer and return an `async_gen` so it can be iterated</span>

<span class="sd">        !!! Example</span>
<span class="sd">            ```python title=&quot;Usage&quot;</span>
<span class="sd">            @stream_engine.stream(topic, group_id=group_id, ...)</span>
<span class="sd">            async def stream(stream):</span>
<span class="sd">                yield cr.value</span>


<span class="sd">            # Iterate the stream:</span>
<span class="sd">            async with stream as stream_flow:</span>
<span class="sd">                async for value in stream_flow:</span>
<span class="sd">                    ...</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting async_gen Stream....&quot;</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">async</span> <span class="k">def</span> <span class="fm">__aexit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">tb</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Stopping async_gen Stream....&quot;</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__aiter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">async</span> <span class="k">def</span> <span class="fm">__anext__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConsumerRecord</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cr</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">getone</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">udf_handler</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">UDFType</span><span class="o">.</span><span class="n">NO_TYPING</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">cr</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">ConsumerStoppedError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopAsyncIteration</span>  <span class="c1"># noqa: F821</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div><h2 id="dependency-injection-and-typing">Dependency Injection and typing</h2>
<p>The old way to itereate over a stream is with the <code>async for _ in stream</code> loop. The iterable approach works but in most cases end users are interested only in the <code>ConsumerRecord</code> and not in the <code>stream</code>, for this reason now it is possible to remove the <code>loop</code> and every time that a new event is in the stream the <code>coroutine</code> function defined by the end user will ba <code>awaited</code>. If the <code>stream</code> is also needed, for example because <code>manual</code> commit is enabled then you can also add the <code>stream</code> as an argument in the coroutine.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Use only the ConsumerRecord</label><label for="__tabbed_1_2">Use ConsumerRecord and Stream</label><label for="__tabbed_1_3">Old fashion</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="nd">@stream_engine</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my-stream&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">my_stream</span><span class="p">(</span><span class="n">cr</span><span class="p">:</span> <span class="n">ConsumerRecord</span><span class="p">):</span>
    <span class="n">save_to_db</span><span class="p">(</span><span class="n">cr</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="nd">@stream_engine</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my-stream&quot;</span><span class="p">,</span> <span class="n">enable_auto_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">my_stream</span><span class="p">(</span><span class="n">cr</span><span class="p">:</span> <span class="n">ConsumerRecord</span><span class="p">,</span> <span class="n">stream</span><span class="p">:</span> <span class="n">Stream</span><span class="p">):</span>
    <span class="n">save_to_db</span><span class="p">(</span><span class="n">cr</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">stream</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="nd">@stream_engine</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my-stream&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">consume</span><span class="p">(</span><span class="n">stream</span><span class="p">):</span>  <span class="c1"># you can specify the type but it will be the same result</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">cr</span> <span class="ow">in</span> <span class="n">stream</span><span class="p">:</span>
        <span class="n">save_to_db</span><span class="p">(</span><span class="n">cr</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="c1"># you can do something with the stream as well!!</span>
</code></pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A proper typing is required in order to remove the <code>async for in</code> loop. The argument order is also important, this might change in the future.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is still possible to use the <code>async for in</code> loop, but it might be removed in the future.</p>
</div>
<h2 id="creating-a-stream-instance">Creating a Stream instance</h2>
<p>If for any reason you need to create <code>Streams</code> instances directly, you can do it without using the decorator <code>stream_engine.stream</code>.</p>
<div class="highlight"><span class="filename">Stream instance</span><pre><span></span><code><span class="kn">import</span> <span class="nn">aiorun</span>
<span class="kn">from</span> <span class="nn">kstreams</span> <span class="kn">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">Stream</span><span class="p">,</span> <span class="n">ConsumerRecord</span>

<span class="n">stream_engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;my-stream-engine&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MyDeserializer</span><span class="p">:</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">consumer_record</span><span class="p">:</span> <span class="n">ConsumerRecord</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">consumer_record</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">stream</span><span class="p">(</span><span class="n">cr</span><span class="p">:</span> <span class="n">ConsumerRecord</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event consumed: headers: </span><span class="si">{</span><span class="n">cr</span><span class="o">.</span><span class="n">headers</span><span class="si">}</span><span class="s2">, payload: </span><span class="si">{</span><span class="n">cr</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="n">stream</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span>
    <span class="s2">&quot;local--kstreams&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my-stream&quot;</span>
    <span class="n">func</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span>  <span class="c1"># coroutine or async generator</span>
    <span class="n">deserializer</span><span class="o">=</span><span class="n">MyDeserializer</span><span class="p">(),</span>
<span class="p">)</span>
<span class="c1"># add the stream to the engine</span>
<span class="n">stream_engine</span><span class="o">.</span><span class="n">add_stream</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">start</span><span class="p">():</span>
    <span class="k">await</span> <span class="n">stream_engine</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">produce</span><span class="p">()</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="n">loop</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">stream_engine</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">aiorun</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">start</span><span class="p">(),</span> <span class="n">stop_on_unhandled_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shutdown_callback</span><span class="o">=</span><span class="n">shutdown</span><span class="p">)</span>
</code></pre></div>
<h3 id="removing-a-stream-from-the-engine">Removing a stream from the engine</h3>
<div class="highlight"><span class="filename">Removing stream</span><pre><span></span><code><span class="n">stream_engine</span><span class="o">.</span><span class="n">remove_stream</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</code></pre></div>
<h3 id="starting-the-stream-with-initial-offsets">Starting the stream with initial offsets</h3>
<p>If you want to start your consumption from certain offsets, you can include that in your stream instantiation.</p>
<p>Use case:
This feature is useful if one wants to manage their own offsets, rather than committing consumed offsets to Kafka.
When an application manages its own offsets and tries to start a stream, we start the stream using the initial
offsets as defined in the database.</p>
<p>If you try to seek on a partition or topic that is not assigned to your stream, the code will ignore the seek
and print out a warning. For example, if you have two consumers that are consuming from different partitions,
and you try to seek for all of the partitions on each consumer, each consumer will seek for the partitions
it has been assigned, and it will print out a warning log for the ones it was not assigned.</p>
<p>If you try to seek on offsets that are not yet present on your partition, the consumer will revert to the auto_offset_reset
config. There will not be a warning, so be aware of this.</p>
<p>Also be aware that when your application restarts, it most likely will trigger the initial_offsets again.
This means that setting intial_offsets to be a hardcoded number might not get the results you expect.</p>
<div class="highlight"><span class="filename">Initial Offsets from Database</span><pre><span></span><code><span class="kn">from</span> <span class="nn">kstreams</span> <span class="kn">import</span> <span class="n">Stream</span><span class="p">,</span> <span class="n">structs</span>


<span class="n">topic_name</span> <span class="o">=</span> <span class="s2">&quot;local--kstreams&quot;</span>
<span class="n">db_table</span> <span class="o">=</span> <span class="n">ExampleDatabase</span><span class="p">()</span>
<span class="n">initial_offset</span> <span class="o">=</span> <span class="n">structs</span><span class="o">.</span><span class="n">TopicPartitionOffset</span><span class="p">(</span><span class="n">topic</span><span class="o">=</span><span class="n">topic_name</span><span class="p">,</span> <span class="n">partition</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">db_table</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">my_stream</span><span class="p">(</span><span class="n">stream</span><span class="p">:</span> <span class="n">Stream</span><span class="p">):</span>
    <span class="o">...</span>


<span class="n">stream</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span>
    <span class="n">topic_name</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my-stream&quot;</span><span class="p">,</span>
    <span class="n">func</span><span class="o">=</span><span class="n">my_stream</span><span class="p">,</span>  <span class="c1"># coroutine or async generator</span>
    <span class="n">deserializer</span><span class="o">=</span><span class="n">MyDeserializer</span><span class="p">(),</span>
    <span class="n">initial_offsets</span><span class="o">=</span><span class="p">[</span><span class="n">initial_offset</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div>
<h2 id="stream-crashing">Stream crashing</h2>
<p>If your stream <code>crashes</code> for any reason, the event consumption will stop meaning that non event will be consumed from the <code>topic</code>.
As an end user you are responsable of deciding what to do. In future version approaches like <code>re-try</code>, <code>stream engine stops on stream crash</code> might be introduced.</p>
<div class="highlight"><span class="filename">Crashing example</span><pre><span></span><code><span class="kn">import</span> <span class="nn">aiorun</span>
<span class="kn">from</span> <span class="nn">kstreams</span> <span class="kn">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">ConsumerRecord</span>

<span class="n">stream_engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;my-stream-engine&quot;</span><span class="p">)</span>


<span class="nd">@stream_engine</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="s2">&quot;local--kstreams&quot;</span><span class="p">,</span> <span class="n">group_id</span><span class="o">=</span><span class="s2">&quot;de-my-partition&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">stream</span><span class="p">(</span><span class="n">cr</span><span class="p">:</span> <span class="n">ConsumerRecord</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event consumed. Payload </span><span class="si">{</span><span class="n">cr</span><span class="o">.</span><span class="n">payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">produce</span><span class="p">():</span>
    <span class="k">await</span> <span class="n">stream_engine</span><span class="o">.</span><span class="n">send</span><span class="p">(</span>
        <span class="s2">&quot;local--kstreams&quot;</span><span class="p">,</span>
        <span class="n">value</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;Hi&quot;</span>
    <span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">start</span><span class="p">():</span>
    <span class="k">await</span> <span class="n">stream_engine</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">produce</span><span class="p">()</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="n">loop</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">stream_engine</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">aiorun</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">start</span><span class="p">(),</span> <span class="n">stop_on_unhandled_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shutdown_callback</span><span class="o">=</span><span class="n">shutdown</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>CRASHED<span class="w"> </span>Stream!!!<span class="w"> </span>Task<span class="w"> </span>&lt;Task<span class="w"> </span>pending<span class="w"> </span><span class="nv">name</span><span class="o">=</span><span class="s1">&#39;Task-23&#39;</span><span class="w"> </span><span class="nv">coro</span><span class="o">=</span>&lt;BaseStream.start.&lt;locals&gt;.func_wrapper<span class="o">()</span><span class="w"> </span>running<span class="w"> </span>at<span class="w"> </span>/Users/Projects/kstreams/kstreams/streams.py:55&gt;&gt;

<span class="w"> </span><span class="s1">&#39;ConsumerRecord&#39;</span><span class="w"> </span>object<span class="w"> </span>has<span class="w"> </span>no<span class="w"> </span>attribute<span class="w"> </span><span class="s1">&#39;payload&#39;</span>
Traceback<span class="w"> </span><span class="o">(</span>most<span class="w"> </span>recent<span class="w"> </span>call<span class="w"> </span>last<span class="o">)</span>:
<span class="w">  </span>File<span class="w"> </span><span class="s2">&quot;/Users/Projects/kstreams/kstreams/streams.py&quot;</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">52</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>func_wrapper
<span class="w">    </span>await<span class="w"> </span>self.func<span class="o">(</span>self<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">&quot;/Users/Projects/kstreams/examples/fastapi_example/streaming/streams.py&quot;</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">9</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>stream
<span class="w">    </span>print<span class="o">(</span>f<span class="s2">&quot;Event consumed: headers: {cr.headers}, payload: {cr.payload}&quot;</span><span class="o">)</span>
AttributeError:<span class="w"> </span><span class="s1">&#39;ConsumerRecord&#39;</span><span class="w"> </span>object<span class="w"> </span>has<span class="w"> </span>no<span class="w"> </span>attribute<span class="w"> </span><span class="s1">&#39;payload&#39;</span>
</code></pre></div>
<h2 id="consuming-from-multiple-topics">Consuming from multiple topics</h2>
<p>Consuming from multiple topics using one <code>stream</code> is possible. A <code>List[str]</code> of topics must be provided.</p>
<div class="highlight"><span class="filename">Consume from multiple topics</span><pre><span></span><code><span class="n">stream_engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;my-stream-engine&quot;</span><span class="p">)</span>


<span class="nd">@stream_engine</span><span class="o">.</span><span class="n">stream</span><span class="p">([</span><span class="s2">&quot;local--kstreams&quot;</span><span class="p">,</span> <span class="s2">&quot;local--hello-world&quot;</span><span class="p">],</span> <span class="n">group_id</span><span class="o">=</span><span class="s2">&quot;example-group&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">consume</span><span class="p">(</span><span class="n">cr</span><span class="p">:</span> <span class="n">ConsumerRecord</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event consumed from topic </span><span class="si">{</span><span class="n">cr</span><span class="o">.</span><span class="n">topic</span><span class="si">}</span><span class="s2">: headers: </span><span class="si">{</span><span class="n">cr</span><span class="o">.</span><span class="n">headers</span><span class="si">}</span><span class="s2">, payload: </span><span class="si">{</span><span class="n">cr</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="changing-consumer-behavior">Changing consumer behavior</h2>
<p>Most of the time you will only set the <code>topic</code> and the <code>group_id</code> to the <code>consumer</code>, but sometimes you might want more control over it, for example changing the <code>policy for resetting offsets on OffsetOutOfRange errors</code> or <code>session timeout</code>. To do this, you have to use the same <code>kwargs</code> as the <a href="https://aiokafka.readthedocs.io/en/stable/api.html#aiokafkaconsumer-class">aiokafka consumer</a> API</p>
<div class="highlight"><pre><span></span><code><span class="c1"># The consumer sends periodic heartbeats every 500 ms</span>
<span class="c1"># On OffsetOutOfRange errors, the offset will move to the oldest available message (earliest)</span>

<span class="nd">@stream_engine</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="s2">&quot;local--kstream&quot;</span><span class="p">,</span> <span class="n">group_id</span><span class="o">=</span><span class="s2">&quot;de-my-partition&quot;</span><span class="p">,</span> <span class="n">session_timeout_ms</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">auto_offset_reset</span><span class="s2">&quot;earliest&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">stream</span><span class="p">(</span><span class="n">cr</span><span class="p">:</span> <span class="n">ConsumerRecord</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event consumed: headers: </span><span class="si">{</span><span class="n">cr</span><span class="o">.</span><span class="n">headers</span><span class="si">}</span><span class="s2">, payload: </span><span class="si">{</span><span class="n">cr</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="manual-commit">Manual commit</h2>
<p>When processing more sensitive data and you want to be sure that the <code>kafka offeset</code> is commited once that you have done your tasks, you can use <code>enable_auto_commit=False</code> mode of Consumer.</p>
<div class="highlight"><span class="filename">Manual commit example</span><pre><span></span><code><span class="nd">@stream_engine</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="s2">&quot;local--kstream&quot;</span><span class="p">,</span> <span class="n">group_id</span><span class="o">=</span><span class="s2">&quot;de-my-partition&quot;</span><span class="p">,</span> <span class="n">enable_auto_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">stream</span><span class="p">(</span><span class="n">cr</span><span class="p">:</span> <span class="n">ConsumerRecord</span><span class="p">,</span> <span class="n">stream</span><span class="p">:</span> <span class="n">Stream</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event consumed: headers: </span><span class="si">{</span><span class="n">cr</span><span class="o">.</span><span class="n">headers</span><span class="si">}</span><span class="s2">, payload: </span><span class="si">{</span><span class="n">cr</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># We need to make sure that the pyalod was stored before commiting the kafka offset</span>
    <span class="k">await</span> <span class="n">store_in_database</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">stream</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>  <span class="c1"># You need to commit!!!</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is a tradeoff from at most once to at least once delivery, to achieve exactly once you will need to save offsets in the destination database and validate those yourself.</p>
</div>
<h2 id="yield-from-stream">Yield from stream</h2>
<p>Sometimes is useful to <code>yield</code> values from a <code>stream</code> so you can consume events in your on phase or because you want to return results to the frontend (SSE example).
If you use the <code>yield</code> keyword inside a <code>coroutine</code> it will be "transform" to a  <code>asynchronous generator function</code>, meaning that inside there is an <code>async generator</code> and it can be consumed.</p>
<p>Consuming an <code>async generator</code> is simple, you just use the <code>async for in</code> clause. Because consuming events only happens with the <code>for loop</code>, you have to make sure that the <code>Stream</code> has been started properly and after leaving the <code>async for in</code> the <code>stream</code> has been properly stopped.</p>
<p>To facilitate the process, we have <code>context manager</code> that makes sure of the <code>starting/stopping</code> process.</p>
<div class="highlight"><span class="filename">Yield example</span><pre><span></span><code><span class="c1"># Create your stream</span>
<span class="nd">@stream_engine</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="s2">&quot;local--kstream&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">stream</span><span class="p">(</span><span class="n">cr</span><span class="p">:</span> <span class="n">ConsumerRecord</span><span class="p">,</span> <span class="n">stream</span><span class="p">:</span> <span class="n">Stream</span><span class="p">):</span>
    <span class="k">yield</span> <span class="n">cr</span><span class="o">.</span><span class="n">value</span>


<span class="c1"># Consume the stream:</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">stream</span> <span class="k">as</span> <span class="n">stream_flow</span><span class="p">:</span>  <span class="c1"># Use the context manager</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">stream_flow</span><span class="p">:</span>
        <span class="o">...</span>
        <span class="c1"># do something with value (cr.value)</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If for some reason you interrupt the "async for in" in the async generator, the Stream will stopped consuming events
meaning that the lag will increase.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Yield from a stream only works with the <a href="https://kpn.github.io/kstreams/stream/#dependency-injection-and-typing">typing approach</a></p>
</div>
<h2 id="get-many">Get many</h2>



<div class="doc doc-object doc-function">



<a id="kstreams.streams.Stream.getmany"></a>
  <div class="doc doc-contents first">
  
      <p>Get a batch of events from the assigned TopicPartition.</p>
<p>Prefetched events are returned in batches by topic-partition.
If messages is not available in the prefetched buffer this method waits
<code>timeout_ms</code> milliseconds.</p>



  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>partitions</code></td>
          <td>
                <code>List[<span title="kstreams.TopicPartition">TopicPartition</span>] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The partitions that need
fetching message. If no one partition specified then all
subscribed partitions will be used</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>timeout_ms</code></td>
          <td>
                <code>int | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>milliseconds spent waiting if
data is not available in the buffer. If 0, returns immediately
with any records that are available currently in the buffer,
else returns empty. Must not be negative.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>max_records</code></td>
          <td>
                <code>int | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The amount of records to fetch.
if <code>timeout_ms</code> was defined and reached and the fetched records
has not reach <code>max_records</code> then returns immediately
with any records that are available currently in the buffer</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Dict">Dict</span>[<span title="kstreams.TopicPartition">TopicPartition</span>, <span title="typing.List">List</span>[<span title="kstreams.ConsumerRecord">ConsumerRecord</span>]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Topic to list of records</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>
      <div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="nd">@stream_engine</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">stream</span><span class="p">(</span><span class="n">stream</span><span class="p">:</span> <span class="n">Stream</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">stream</span><span class="o">.</span><span class="n">getmany</span><span class="p">(</span><span class="n">max_records</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div>
</div>

          <details class="quote">
            <summary>Source code in <code>kstreams/streams.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">getmany</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">partitions</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">TopicPartition</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">timeout_ms</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">max_records</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="n">TopicPartition</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">ConsumerRecord</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a batch of events from the assigned TopicPartition.</span>

<span class="sd">    Prefetched events are returned in batches by topic-partition.</span>
<span class="sd">    If messages is not available in the prefetched buffer this method waits</span>
<span class="sd">    `timeout_ms` milliseconds.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        partitions List[TopicPartition] | None: The partitions that need</span>
<span class="sd">            fetching message. If no one partition specified then all</span>
<span class="sd">            subscribed partitions will be used</span>
<span class="sd">        timeout_ms int | None: milliseconds spent waiting if</span>
<span class="sd">            data is not available in the buffer. If 0, returns immediately</span>
<span class="sd">            with any records that are available currently in the buffer,</span>
<span class="sd">            else returns empty. Must not be negative.</span>
<span class="sd">        max_records int | None: The amount of records to fetch.</span>
<span class="sd">            if `timeout_ms` was defined and reached and the fetched records</span>
<span class="sd">            has not reach `max_records` then returns immediately</span>
<span class="sd">            with any records that are available currently in the buffer</span>

<span class="sd">    Returns:</span>
<span class="sd">        Topic to list of records</span>

<span class="sd">    !!! Example</span>
<span class="sd">        ```python</span>
<span class="sd">        @stream_engine.stream(topic, ...)</span>
<span class="sd">        async def stream(stream: Stream):</span>
<span class="sd">            while True:</span>
<span class="sd">                data = await stream.getmany(max_records=5)</span>
<span class="sd">                print(data)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">partitions</span> <span class="o">=</span> <span class="n">partitions</span> <span class="ow">or</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="o">.</span><span class="n">getmany</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
        <span class="o">*</span><span class="n">partitions</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="o">=</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="n">max_records</span><span class="o">=</span><span class="n">max_records</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div><div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This approach does not works with <code>Dependency Injection</code>.</p>
</div>
<h2 id="rebalance-listener">Rebalance Listener</h2>
<p>For some cases you will need a <code>RebalanceListener</code> so when partitions are <code>assigned</code> or <code>revoked</code> to the stream different accions can be performed.</p>
<h3 id="use-cases">Use cases</h3>
<ul>
<li>Cleanup or custom state save on the start of a rebalance operation</li>
<li>Saving offsets in a custom store when a partition is <code>revoked</code></li>
<li>Load a state or cache warmup on completion of a successful partition re-assignment.</li>
</ul>
<h3 id="metrics-rebalance-listener">Metrics Rebalance Listener</h3>
<p>Kstreams use a default listener for all the streams to clean the metrics after a rebalance takes place</p>


<div class="doc doc-object doc-class">




<h2 id="kstreams.MetricsRebalanceListener" class="doc doc-heading">
          <code>kstreams.MetricsRebalanceListener</code>


</h2>


  <div class="doc doc-contents first">


            <details class="quote">
              <summary>Source code in <code>kstreams/rebalance_listener.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MetricsRebalanceListener</span><span class="p">(</span><span class="n">RebalanceListener</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">on_partitions_revoked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">revoked</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">TopicPartition</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Coroutine to be called *before* a rebalance operation starts and</span>
<span class="sd">        *after* the consumer stops fetching data.</span>

<span class="sd">        This will method will clean up the `Prometheus` metrics</span>

<span class="sd">        Attributes:</span>
<span class="sd">            revoked Set[TopicPartitions]: Partitions that were assigned</span>
<span class="sd">                to the consumer on the last rebalance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># lock all asyncio Tasks so no new metrics will be added to the Monitor</span>
        <span class="k">if</span> <span class="n">revoked</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">clean_stream_consumer_metrics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">on_partitions_assigned</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assigned</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">TopicPartition</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Coroutine to be called *after* partition re-assignment completes</span>
<span class="sd">        and *before* the consumer starts fetching data again.</span>

<span class="sd">        This method will start the `Prometheus` metrics</span>

<span class="sd">        Attributes:</span>
<span class="sd">            assigned Set[TopicPartition]: Partitions assigned to the</span>
<span class="sd">                consumer (may include partitions that were previously assigned)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># lock all asyncio Tasks so no new metrics will be added to the Monitor</span>
        <span class="k">if</span> <span class="n">assigned</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">seek_to_initial_offsets</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="kstreams.MetricsRebalanceListener.on_partitions_assigned" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">on_partitions_assigned</span><span class="p">(</span><span class="n">assigned</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Coroutine to be called <em>after</em> partition re-assignment completes
and <em>before</em> the consumer starts fetching data again.</p>
<p>This method will start the <code>Prometheus</code> metrics</p>



  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>assigned</code></td>
          <td>
                <code><span title="typing.Set">Set</span>[<span title="kstreams.TopicPartition">TopicPartition</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Partitions assigned to the
consumer (may include partitions that were previously assigned)</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>kstreams/rebalance_listener.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">on_partitions_assigned</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assigned</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">TopicPartition</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coroutine to be called *after* partition re-assignment completes</span>
<span class="sd">    and *before* the consumer starts fetching data again.</span>

<span class="sd">    This method will start the `Prometheus` metrics</span>

<span class="sd">    Attributes:</span>
<span class="sd">        assigned Set[TopicPartition]: Partitions assigned to the</span>
<span class="sd">            consumer (may include partitions that were previously assigned)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># lock all asyncio Tasks so no new metrics will be added to the Monitor</span>
    <span class="k">if</span> <span class="n">assigned</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">seek_to_initial_offsets</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="kstreams.MetricsRebalanceListener.on_partitions_revoked" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">on_partitions_revoked</span><span class="p">(</span><span class="n">revoked</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Coroutine to be called <em>before</em> a rebalance operation starts and
<em>after</em> the consumer stops fetching data.</p>
<p>This will method will clean up the <code>Prometheus</code> metrics</p>



  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>revoked</code></td>
          <td>
                <code><span title="typing.Set">Set</span>[TopicPartitions]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Partitions that were assigned
to the consumer on the last rebalance</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>kstreams/rebalance_listener.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">on_partitions_revoked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">revoked</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">TopicPartition</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coroutine to be called *before* a rebalance operation starts and</span>
<span class="sd">    *after* the consumer stops fetching data.</span>

<span class="sd">    This will method will clean up the `Prometheus` metrics</span>

<span class="sd">    Attributes:</span>
<span class="sd">        revoked Set[TopicPartitions]: Partitions that were assigned</span>
<span class="sd">            to the consumer on the last rebalance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># lock all asyncio Tasks so no new metrics will be added to the Monitor</span>
    <span class="k">if</span> <span class="n">revoked</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">clean_stream_consumer_metrics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><h3 id="manual-commit_1">Manual Commit</h3>
<p>If <code>manual</code> commit is enabled, you migh want to use the <code>ManualCommitRebalanceListener</code>. This <code>rebalance listener</code> will call <code>commit</code>
before the <code>stream</code> partitions are revoked to avoid the error <code>CommitFailedError</code> and <em>duplicate</em> message delivery after a rebalance. See code <a href="https://github.com/kpn/kstreams/tree/master/examples/stream-with-manual-commit">example</a> with
manual <code>commit</code></p>


<div class="doc doc-object doc-class">




<h2 id="kstreams.ManualCommitRebalanceListener" class="doc doc-heading">
          <code>kstreams.ManualCommitRebalanceListener</code>


</h2>


  <div class="doc doc-contents first">


            <details class="quote">
              <summary>Source code in <code>kstreams/rebalance_listener.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ManualCommitRebalanceListener</span><span class="p">(</span><span class="n">MetricsRebalanceListener</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">on_partitions_revoked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">revoked</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">TopicPartition</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Coroutine to be called *before* a rebalance operation starts and</span>
<span class="sd">        *after* the consumer stops fetching data.</span>

<span class="sd">        If manual commit is enabled, `commit` is called before the consumers</span>
<span class="sd">        partitions are revoked to prevent the error `CommitFailedError`</span>
<span class="sd">        and duplicate message delivery after a rebalance.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            revoked Set[TopicPartitions]: Partitions that were assigned</span>
<span class="sd">                to the consumer on the last rebalance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">revoked</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">consumer</span><span class="o">.</span><span class="n">_enable_auto_commit</span>
        <span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Manual commit enabled for stream </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="s2">&quot;Performing `commit` before revoking partitions&quot;</span>
            <span class="p">)</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span><span class="p">():</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

            <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_partitions_revoked</span><span class="p">(</span><span class="n">revoked</span><span class="o">=</span><span class="n">revoked</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="kstreams.ManualCommitRebalanceListener.on_partitions_revoked" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">on_partitions_revoked</span><span class="p">(</span><span class="n">revoked</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Coroutine to be called <em>before</em> a rebalance operation starts and
<em>after</em> the consumer stops fetching data.</p>
<p>If manual commit is enabled, <code>commit</code> is called before the consumers
partitions are revoked to prevent the error <code>CommitFailedError</code>
and duplicate message delivery after a rebalance.</p>



  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>revoked</code></td>
          <td>
                <code><span title="typing.Set">Set</span>[TopicPartitions]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Partitions that were assigned
to the consumer on the last rebalance</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>kstreams/rebalance_listener.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">on_partitions_revoked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">revoked</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">TopicPartition</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coroutine to be called *before* a rebalance operation starts and</span>
<span class="sd">    *after* the consumer stops fetching data.</span>

<span class="sd">    If manual commit is enabled, `commit` is called before the consumers</span>
<span class="sd">    partitions are revoked to prevent the error `CommitFailedError`</span>
<span class="sd">    and duplicate message delivery after a rebalance.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        revoked Set[TopicPartitions]: Partitions that were assigned</span>
<span class="sd">            to the consumer on the last rebalance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">revoked</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">consumer</span><span class="o">.</span><span class="n">_enable_auto_commit</span>
    <span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Manual commit enabled for stream </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="s2">&quot;Performing `commit` before revoking partitions&quot;</span>
        <span class="p">)</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span><span class="p">():</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_partitions_revoked</span><span class="p">(</span><span class="n">revoked</span><span class="o">=</span><span class="n">revoked</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>ManualCommitRebalanceListener</code> also includes the <code>MetricsRebalanceListener</code> funcionality.</p>
</div>
<h3 id="custom-rebalance-listener">Custom Rebalance Listener</h3>
<p>If you want to define a custom <code>RebalanceListener</code>, it has to inherits from <code>kstreams.RebalanceListener</code>.</p>


<div class="doc doc-object doc-class">




<h2 id="kstreams.RebalanceListener" class="doc doc-heading">
          <code>kstreams.RebalanceListener</code>


</h2>


  <div class="doc doc-contents first">

  
      <p>A callback interface that the user can implement to trigger custom actions
when the set of partitions are assigned or revoked to the <code>Stream</code>.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">kstreams</span> <span class="kn">import</span> <span class="n">RebalanceListener</span><span class="p">,</span> <span class="n">TopicPartition</span>
<span class="kn">from</span> <span class="nn">.resource</span> <span class="kn">import</span> <span class="n">stream_engine</span>


<span class="k">class</span> <span class="nc">MyRebalanceListener</span><span class="p">(</span><span class="n">RebalanceListener</span><span class="p">):</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">on_partitions_revoked</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">revoked</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">TopicPartition</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Do something with the revoked partitions</span>
        <span class="c1"># or with the Stream</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">on_partitions_assigned</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">assigned</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">TopicPartition</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Do something with the assigned partitions</span>
        <span class="c1"># or with the Stream</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>


<span class="nd">@stream_engine</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">rebalance_listener</span><span class="o">=</span><span class="n">MyRebalanceListener</span><span class="p">())</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">my_stream</span><span class="p">(</span><span class="n">stream</span><span class="p">:</span> <span class="n">Stream</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">stream</span><span class="p">:</span>
        <span class="o">...</span>
</code></pre></div>
</div>

            <details class="quote">
              <summary>Source code in <code>kstreams/rebalance_listener.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RebalanceListener</span><span class="p">(</span><span class="n">ConsumerRebalanceListener</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A callback interface that the user can implement to trigger custom actions</span>
<span class="sd">    when the set of partitions are assigned or revoked to the `Stream`.</span>

<span class="sd">    !!! Example</span>
<span class="sd">        ```python</span>
<span class="sd">        from kstreams import RebalanceListener, TopicPartition</span>
<span class="sd">        from .resource import stream_engine</span>


<span class="sd">        class MyRebalanceListener(RebalanceListener):</span>

<span class="sd">            async def on_partitions_revoked(</span>
<span class="sd">                self, revoked: Set[TopicPartition]</span>
<span class="sd">            ) -&gt; None:</span>
<span class="sd">                # Do something with the revoked partitions</span>
<span class="sd">                # or with the Stream</span>
<span class="sd">                print(self.stream)</span>

<span class="sd">            async def on_partitions_assigned(</span>
<span class="sd">                self, assigned: Set[TopicPartition]</span>
<span class="sd">            ) -&gt; None:</span>
<span class="sd">                # Do something with the assigned partitions</span>
<span class="sd">                # or with the Stream</span>
<span class="sd">                print(self.stream)</span>


<span class="sd">        @stream_engine.stream(topic, rebalance_listener=MyRebalanceListener())</span>
<span class="sd">        async def my_stream(stream: Stream):</span>
<span class="sd">            async for event in stream:</span>
<span class="sd">                ...</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># engine added so it can react on rebalance events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">on_partitions_revoked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">revoked</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">TopicPartition</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Coroutine to be called *before* a rebalance operation starts and</span>
<span class="sd">        *after* the consumer stops fetching data.</span>

<span class="sd">        If you are using manual commit you have to commit all consumed offsets</span>
<span class="sd">        here, to avoid duplicate message delivery after rebalance is finished.</span>

<span class="sd">        Use cases:</span>
<span class="sd">            - cleanup or custom state save on the start of a rebalance operation</span>
<span class="sd">            - saving offsets in a custom store</span>

<span class="sd">        Attributes:</span>
<span class="sd">            revoked Set[TopicPartitions]: Partitions that were assigned</span>
<span class="sd">                to the consumer on the last rebalance</span>

<span class="sd">        !!! note</span>
<span class="sd">            The `Stream` is available using `self.stream`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span>  <span class="c1"># pragma: no cover</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">on_partitions_assigned</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assigned</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">TopicPartition</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Coroutine to be called *after* partition re-assignment completes</span>
<span class="sd">        and *before* the consumer starts fetching data again.</span>

<span class="sd">        It is guaranteed that all the processes in a consumer group will</span>
<span class="sd">        execute their `on_partitions_revoked` callback before any instance</span>
<span class="sd">        executes its `on_partitions_assigned` callback.</span>

<span class="sd">        Use cases:</span>
<span class="sd">            - Load a state or cache warmup on completion of a successful</span>
<span class="sd">            partition re-assignment.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            assigned Set[TopicPartition]: Partitions assigned to the</span>
<span class="sd">                consumer (may include partitions that were previously assigned)</span>

<span class="sd">        !!! note</span>
<span class="sd">            The `Stream` is available using `self.stream`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span>  <span class="c1"># pragma: no cover</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="kstreams.RebalanceListener.on_partitions_assigned" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">on_partitions_assigned</span><span class="p">(</span><span class="n">assigned</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Coroutine to be called <em>after</em> partition re-assignment completes
and <em>before</em> the consumer starts fetching data again.</p>
<p>It is guaranteed that all the processes in a consumer group will
execute their <code>on_partitions_revoked</code> callback before any instance
executes its <code>on_partitions_assigned</code> callback.</p>

<details class="use-cases" open>
  <summary>Use cases</summary>
  <ul>
<li>Load a state or cache warmup on completion of a successful
partition re-assignment.</li>
</ul>
</details>


  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>assigned</code></td>
          <td>
                <code><span title="typing.Set">Set</span>[<span title="kstreams.TopicPartition">TopicPartition</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Partitions assigned to the
consumer (may include partitions that were previously assigned)</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>
      <div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>Stream</code> is available using <code>self.stream</code></p>
</div>

          <details class="quote">
            <summary>Source code in <code>kstreams/rebalance_listener.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">on_partitions_assigned</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assigned</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">TopicPartition</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coroutine to be called *after* partition re-assignment completes</span>
<span class="sd">    and *before* the consumer starts fetching data again.</span>

<span class="sd">    It is guaranteed that all the processes in a consumer group will</span>
<span class="sd">    execute their `on_partitions_revoked` callback before any instance</span>
<span class="sd">    executes its `on_partitions_assigned` callback.</span>

<span class="sd">    Use cases:</span>
<span class="sd">        - Load a state or cache warmup on completion of a successful</span>
<span class="sd">        partition re-assignment.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        assigned Set[TopicPartition]: Partitions assigned to the</span>
<span class="sd">            consumer (may include partitions that were previously assigned)</span>

<span class="sd">    !!! note</span>
<span class="sd">        The `Stream` is available using `self.stream`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>  <span class="c1"># pragma: no cover</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="kstreams.RebalanceListener.on_partitions_revoked" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">on_partitions_revoked</span><span class="p">(</span><span class="n">revoked</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Coroutine to be called <em>before</em> a rebalance operation starts and
<em>after</em> the consumer stops fetching data.</p>
<p>If you are using manual commit you have to commit all consumed offsets
here, to avoid duplicate message delivery after rebalance is finished.</p>

<details class="use-cases" open>
  <summary>Use cases</summary>
  <ul>
<li>cleanup or custom state save on the start of a rebalance operation</li>
<li>saving offsets in a custom store</li>
</ul>
</details>


  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>revoked</code></td>
          <td>
                <code><span title="typing.Set">Set</span>[TopicPartitions]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Partitions that were assigned
to the consumer on the last rebalance</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>
      <div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>Stream</code> is available using <code>self.stream</code></p>
</div>

          <details class="quote">
            <summary>Source code in <code>kstreams/rebalance_listener.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">on_partitions_revoked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">revoked</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">TopicPartition</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coroutine to be called *before* a rebalance operation starts and</span>
<span class="sd">    *after* the consumer stops fetching data.</span>

<span class="sd">    If you are using manual commit you have to commit all consumed offsets</span>
<span class="sd">    here, to avoid duplicate message delivery after rebalance is finished.</span>

<span class="sd">    Use cases:</span>
<span class="sd">        - cleanup or custom state save on the start of a rebalance operation</span>
<span class="sd">        - saving offsets in a custom store</span>

<span class="sd">    Attributes:</span>
<span class="sd">        revoked Set[TopicPartitions]: Partitions that were assigned</span>
<span class="sd">            to the consumer on the last rebalance</span>

<span class="sd">    !!! note</span>
<span class="sd">        The `Stream` is available using `self.stream`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>  <span class="c1"># pragma: no cover</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>It also possible to inherits from <code>ManualCommitRebalanceListener</code> and <code>MetricsRebalanceListener</code></p>
</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../engine/" class="md-footer__link md-footer__link--prev" aria-label="Previous: StreamEngine" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              StreamEngine
            </div>
          </div>
        </a>
      
      
        
        <a href="../backends/" class="md-footer__link md-footer__link--next" aria-label="Next: Backends" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Backends
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["search.suggest", "search.highlight", "content.tabs.link", "content.code.annotate"], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>